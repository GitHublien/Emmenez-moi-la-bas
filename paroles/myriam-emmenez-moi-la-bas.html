<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emmenez-moi l&agrave;-bas &mdash; Myriam Abel</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --myriam: #2b2b2b;
            --choeurs: #c0651a;
            --ensemble: #8b4513;
            --instru: #5a8a6a;
            --note: #8a7ba0;
            --tempo: #7a9cc0;
            --fond: #faf8f4;
            --page: #fff;
            --or: #c9a86c;
            --sep: #e8e4dc;
            --gris: #999;
            --daw-bg: #1e1e1e;
            --daw-track: #2a2a2a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Lora', Georgia, serif;
            background: var(--fond);
            color: var(--myriam);
            font-size: 18px;
            line-height: 1.85;
            -webkit-font-smoothing: antialiased;
            padding-bottom: 140px;
        }

        .page {
            max-width: 700px;
            margin: 0 auto;
            background: var(--page);
            min-height: 100vh;
            box-shadow: 0 0 80px rgba(0,0,0,0.04);
        }

        /* ─── EN-TÊTE ─── */
        header {
            text-align: center;
            padding: 50px 30px 35px;
            background: linear-gradient(180deg, #f7f3ec 0%, var(--page) 100%);
        }

        header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5em;
            font-weight: 500;
            letter-spacing: 1px;
            line-height: 1.15;
            margin-bottom: 6px;
        }

        header .sous-titre {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.25em;
            color: var(--or);
            font-style: italic;
            letter-spacing: 2px;
            margin-bottom: 18px;
        }

        header .credits {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1em;
            color: var(--gris);
            line-height: 1.7;
        }

        header .credits strong { color: #555; }

        /* ─── MESSAGE ─── */
        .msg {
            margin: 0 28px;
            padding: 22px 26px;
            background: #fdfcf9;
            border: 1px solid var(--sep);
            border-radius: 8px;
            font-size: 0.9em;
            color: #666;
            line-height: 1.8;
        }

        .msg b { color: var(--ensemble); }

        .msg .tempo-exemple {
            display: inline;
            color: var(--tempo);
            font-size: 0.88em;
            letter-spacing: 1px;
        }

        /* ─── LECTEUR DAW FLOTTANT ─── */
        .daw {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 200;
            background: var(--daw-bg);
            border-top: 2px solid #444;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            transition: transform 0.3s;
        }

        .daw.hidden { transform: translateY(100%); }

        .daw-top {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 14px 6px;
        }

        .daw-play {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: 2px solid #888;
            background: transparent;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
            line-height: 1;
            letter-spacing: -2px;
            overflow: hidden;
        }

        .daw-play:hover { border-color: var(--or); color: var(--or); }
        .daw-play.playing { border-color: var(--choeurs); color: var(--choeurs); font-size: 13px; }

        .daw-restart {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1.5px solid #666;
            background: transparent;
            color: #aaa;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .daw-restart:hover { border-color: #fff; color: #fff; }

        .daw-vol-wrap {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-shrink: 0;
        }

        .daw-vol-icon {
            font-size: 16px;
            color: #aaa;
            cursor: pointer;
            user-select: none;
            min-width: 20px;
            text-align: center;
        }

        .daw-vol-icon:hover { color: #fff; }

        .daw-vol-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 70px;
            height: 4px;
            background: #444;
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        .daw-vol-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--or);
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
        }

        .daw-vol-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--or);
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
        }

        .daw-time {
            font-size: 0.78em;
            color: #aaa;
            font-variant-numeric: tabular-nums;
            min-width: 80px;
            text-align: center;
            flex-shrink: 0;
        }

        .daw-progress-wrap {
            height: 28px;
            background: #2a2a2a;
            border-radius: 0;
            cursor: pointer;
            position: relative;
            touch-action: none;
            margin: 0;
            padding: 0;
            border-bottom: 1px solid #333;
        }

        .daw-progress {
            height: 100%;
            background: linear-gradient(90deg,
                rgba(255,0,0,0.3),
                rgba(255,165,0,0.3),
                rgba(255,255,0,0.3),
                rgba(0,200,0,0.3),
                rgba(0,150,255,0.3),
                rgba(130,0,255,0.3),
                rgba(255,0,200,0.3)
            );
            border-radius: 4px;
            width: 0%;
            pointer-events: none;
        }

        .daw-progress-bg {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg,
                rgba(255,0,0,0.08),
                rgba(255,165,0,0.08),
                rgba(255,255,0,0.08),
                rgba(0,200,0,0.08),
                rgba(0,150,255,0.08),
                rgba(130,0,255,0.08),
                rgba(255,0,200,0.08)
            );
            border-radius: 4px;
            pointer-events: none;
            z-index: 0;
        }

        .daw-playhead {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #fff;
            pointer-events: none;
            left: 0%;
            z-index: 5;
            box-shadow: 0 0 6px rgba(255,255,255,0.5);
        }

        .daw-region {
            position: absolute;
            top: 0;
            bottom: 0;
            background: rgba(68,170,68,0.2);
            border-left: 2px solid #4a4;
            border-right: 2px solid #4a4;
            pointer-events: none;
            z-index: 2;
        }

        .daw-marker {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 22px;
            transform: translateX(-11px);
            cursor: grab;
            z-index: 10;
            touch-action: none;
        }

        .daw-marker::before {
            content: attr(data-label);
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            color: #1e1e1e;
            font-size: 9px;
            font-weight: 700;
            padding: 1px 5px;
            border-radius: 3px;
            line-height: 1.2;
        }

        .daw-marker[data-label='A']::before { background: #ff6b6b; color: #fff; }
        .daw-marker[data-label='B']::before { background: #51cf66; color: #fff; }
        .daw-marker[data-label='C']::before { background: #339af0; color: #fff; }
        .daw-marker[data-label='D']::before { background: #fcc419; color: #1e1e1e; }
        .daw-marker[data-label='E']::before { background: #cc5de8; color: #fff; }

        .daw-marker::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 2px;
            transform: translateX(-1px);
            background: #fff;
            opacity: 0.9;
        }

        .daw-marker[data-label='A']::after { background: #ff6b6b; }
        .daw-marker[data-label='B']::after { background: #51cf66; }
        .daw-marker[data-label='C']::after { background: #339af0; }
        .daw-marker[data-label='D']::after { background: #fcc419; }
        .daw-marker[data-label='E']::after { background: #cc5de8; }

        .daw-tracks {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 0;
        }

        .daw-track {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 7px 4px;
            background: var(--daw-track);
            border-right: 1px solid #333;
            cursor: pointer;
            transition: all 0.15s;
            user-select: none;
        }

        .daw-track:last-child { border-right: none; }

        .daw-track.active {
            background: #3a3a3a;
            border-bottom: 2px solid var(--or);
            box-shadow: 0 -2px 8px rgba(201, 168, 108, 0.2);
        }

        .daw.highlight {
            animation: dawFlash 0.5s ease 5;
        }

        @keyframes dawFlash {
            0%, 100% { border-top-color: #444; box-shadow: 0 -4px 20px rgba(0,0,0,0.4); }
            50% { border-top-color: var(--or); border-top-width: 4px; box-shadow: 0 -8px 40px rgba(201,168,108,0.7), 0 0 60px rgba(201,168,108,0.3); }
        }

        .daw-track-name {
            font-size: 0.68em;
            color: #ccc;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .daw-track.active .daw-track-name { color: #fff; font-weight: 600; }

        .daw-track-icon {
            font-size: 1em;
            flex-shrink: 0;
        }

        /* ─── BARRE MARQUEURS ─── */
        .daw-markers {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px 14px 5px;
            border-top: 1px solid #333;
            flex-wrap: wrap;
        }

        .daw-mbtn {
            background: transparent;
            border: 1.5px solid #555;
            color: #aaa;
            border-radius: 14px;
            padding: 2px 9px;
            font-size: 0.68em;
            cursor: pointer;
            transition: all 0.2s;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .daw-mbtn:hover { border-color: #fff; color: #fff; }
        .daw-mbtn.set-A { border-color: #ff6b6b; color: #ff6b6b; background: rgba(255,107,107,0.15); }
        .daw-mbtn.set-B { border-color: #51cf66; color: #51cf66; background: rgba(81,207,102,0.15); }
        .daw-mbtn.set-C { border-color: #339af0; color: #339af0; background: rgba(51,154,240,0.15); }
        .daw-mbtn.set-D { border-color: #fcc419; color: #fcc419; background: rgba(252,196,25,0.15); }
        .daw-mbtn.set-E { border-color: #cc5de8; color: #cc5de8; background: rgba(204,93,232,0.15); }
        .daw-mbtn.loop { border-color: #4a4; color: #4a4; background: rgba(68,170,68,0.12); }
        .daw-mbtn.del { border-color: #e03131; color: #e03131; font-size: 0.75em; padding: 1px 6px; }

        .daw-minfo {
            font-size: 0.6em;
            color: #666;
            margin-left: auto;
            font-variant-numeric: tabular-nums;
        }

        .daw-toggle {
            position: fixed;
            bottom: 8px;
            left: 8px;
            z-index: 201;
            background: var(--daw-bg);
            color: #ccc;
            border: 1px solid #555;
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 0.72em;
            cursor: pointer;
            display: none;
        }

        .daw-toggle.show { display: block; }

        .scroll-btn {
            display: block;
            margin: 18px auto 0;
            background: none;
            border: 1px solid var(--sep);
            color: var(--or);
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.92em;
            padding: 8px 22px;
            border-radius: 20px;
            cursor: pointer;
            letter-spacing: 1px;
            transition: all 0.2s;
        }

        .scroll-btn:hover { background: var(--or); color: #fff; border-color: var(--or); }

        /* ─── LEGENDE ─── */
        .legende {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            padding: 16px 28px;
            border-bottom: 1px solid var(--sep);
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.95em;
        }

        .leg {
            display: flex;
            align-items: center;
            gap: 7px;
        }

        .dot {
            width: 13px;
            height: 13px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .dot-m { background: var(--myriam); }
        .dot-c { background: var(--choeurs); }
        .dot-e { background: linear-gradient(135deg, var(--myriam) 50%, var(--choeurs) 50%); }
        .dot-i { background: var(--instru); }
        .dot-t { background: var(--tempo); width: 20px; height: 3px; border-radius: 2px; }

        .leg-label { color: #777; }

        /* ─── PAROLES ─── */
        .paroles {
            padding: 35px 32px 30px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-head {
            text-align: center;
            margin-bottom: 16px;
            position: relative;
        }

        .section-head::before,
        .section-head::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 55px;
            height: 1px;
            background: var(--sep);
        }

        .section-head::before { right: calc(50% + 75px); }
        .section-head::after { left: calc(50% + 75px); }

        .section-label {
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 5px;
            color: var(--or);
            font-weight: 500;
        }

        .v { padding: 2px 0; }

        .m {
            color: var(--myriam);
            font-size: 1.05em;
        }

        .c {
            color: var(--choeurs);
            font-style: italic;
            margin-left: 28px;
            font-size: 0.95em;
        }

        .e {
            color: var(--myriam);
            font-size: 1.05em;
            padding-left: 12px;
            border-left: 3px solid var(--choeurs);
            background: linear-gradient(90deg, rgba(192, 101, 26, 0.04), transparent);
        }

        .i {
            color: var(--instru);
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
            text-align: center;
            font-size: 1.08em;
            padding: 10px 0;
            letter-spacing: 0.5px;
        }

        .n {
            color: var(--note);
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.95em;
            font-style: italic;
            text-align: center;
            padding: 3px 0;
        }

        .fort { font-weight: 700; }

        .t::after {
            color: var(--tempo);
            font-size: 0.85em;
            opacity: 0.65;
        }
        .t2::after { content: ' \2500\2500'; }
        .t4::after { content: ' \2500\2500\2500\2500'; }
        .t6::after { content: ' \2500\2500\2500\2500\2500\2500'; }
        .t8::after { content: ' \2500\2500\2500\2500\2500\2500\2500\2500'; }
        .t12::after { content: ' \2500\2500\2500\2500\2500\2500\2500\2500\2500\2500\2500\2500'; }

        .gap { height: 14px; }

        /* ─── DROITS ─── */
        .droits {
            text-align: center;
            padding: 28px;
            border-top: 1px solid var(--sep);
            background: #fdfcf9;
        }

        .droits p {
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.95em;
            color: #999;
            line-height: 1.6;
        }

        .droits .copy {
            font-weight: 600;
            color: var(--ensemble);
            margin-top: 10px;
            font-size: 1em;
        }

        footer {
            text-align: center;
            padding: 18px;
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.88em;
            color: #ccc;
            font-style: italic;
        }

        /* ─── CONTROLES ─── */
        .ctrl {
            position: fixed;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 6px;
            z-index: 150;
        }

        .ctrl button {
            background: rgba(40,40,40,0.82);
            color: #fff;
            border: none;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            backdrop-filter: blur(8px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.18);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s;
        }

        .ctrl button:hover { background: var(--or); transform: translateY(-1px); }
        .ctrl button.on { background: var(--choeurs); }

        /* ─── ECRAN ACCUEIL (plein ecran) ─── */
        .splash {
            position: fixed;
            inset: 0;
            z-index: 500;
            background: linear-gradient(135deg, #1a1208 0%, #2c1e0a 40%, #1a1208 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #fff;
            cursor: pointer;
            transition: opacity 0.6s;
        }

        .splash.out {
            opacity: 0;
            pointer-events: none;
        }

        .splash h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3em;
            font-weight: 500;
            letter-spacing: 2px;
            margin-bottom: 10px;
            text-shadow: 0 2px 20px rgba(0,0,0,0.5);
        }

        .splash .splash-sub {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4em;
            color: var(--or);
            font-style: italic;
            letter-spacing: 3px;
            margin-bottom: 40px;
        }

        .splash .splash-tap {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1em;
            color: rgba(255,255,255,0.5);
            letter-spacing: 3px;
            text-transform: uppercase;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* ─── MODE SOMBRE ─── */
        body.dark {
            --myriam: #e8e4dc;
            --fond: #181818;
            --page: #222;
            --sep: #3a3a3a;
            --or: #c9a86c;
            --gris: #888;
        }

        body.dark .msg,
        body.dark .droits { background: #262626; border-color: #3a3a3a; }
        body.dark header { background: linear-gradient(180deg, #1e1e1e, var(--page)); }
        body.dark .e { background: linear-gradient(90deg, rgba(192,101,26,0.08), transparent); }

        /* ─── TAILLES ─── */
        body.sz1 { font-size: 20px; }
        body.sz2 { font-size: 22px; }
        body.sz3 { font-size: 25px; }
        body.sz4 { font-size: 28px; }
        body.sz5 { font-size: 32px; }
        body.sz6 { font-size: 15px; }
        body.sz7 { font-size: 13px; }

        /* ─── RESPONSIVE ─── */
        @media (max-width: 600px) {
            header { padding: 35px 18px 25px; }
            header h1 { font-size: 2em; }
            .paroles { padding: 25px 16px 20px; }
            .msg { margin: 0 16px; padding: 16px 18px; font-size: 0.85em; }
            .c { margin-left: 16px; }
            .legende { gap: 12px; padding: 12px 16px; font-size: 0.88em; }
            .section-head::before, .section-head::after { display: none; }
            .daw-track-name { font-size: 0.55em; letter-spacing: 0; }
            .daw-track-icon { font-size: 0.85em; }
            .daw-track { gap: 3px; padding: 5px 3px; }
            .daw-vol-slider { width: 50px; }
            .daw-top { gap: 6px; padding: 6px 10px 4px; }
            .daw-time { font-size: 0.7em; min-width: 65px; }
            .daw-restart { width: 28px; height: 28px; font-size: 11px; }
            .daw-play { width: 36px; height: 36px; font-size: 15px; }
            .daw-progress-wrap { height: 32px; }
            .daw-marker { width: 26px; transform: translateX(-13px); }
            .daw-markers { gap: 3px; padding: 3px 10px 4px; }
            .daw-mbtn { padding: 2px 6px; font-size: 0.6em; }
            .splash h1 { font-size: 2.2em; }
            .ctrl { top: 8px; right: 8px; }
            .ctrl button { width: 34px; height: 34px; font-size: 12px; }
        }

        @media (max-width: 380px) {
            .daw-vol-slider { width: 36px; }
            .daw-time { font-size: 0.65em; min-width: 55px; }
            .daw-track-name { font-size: 0.5em; }
            .daw-track-icon { font-size: 0.8em; }
            .daw-track { gap: 2px; padding: 4px 2px; }
            .daw-progress-wrap { height: 36px; border-radius: 0; }
        }

        /* ─── PRINT ─── */
        @media print {
            .ctrl, .daw, .splash, .daw-toggle { display: none !important; }
            body { font-size: 11pt; padding-bottom: 0; }
            .page { box-shadow: none; }
            .section { page-break-inside: avoid; }
        }
    </style>
</head>
<body>

<!-- ECRAN D'ACCUEIL -->
<div class="splash" id="splash" onclick="enterPage()">
    <h1>Emmenez-moi l&agrave;-bas</h1>
    <div class="splash-sub">Myriam Abel</div>
    <div class="splash-tap">Appuie pour commencer</div>
</div>

<!-- CONTROLES -->
<div class="ctrl">
    <button onclick="resize()" title="Taille du texte">Aa</button>
    <button id="dk" onclick="dark()" title="Mode sombre">&#9789;</button>
    <button id="fs" onclick="toggleFS()" title="Plein &eacute;cran">&#9974;</button>
</div>

<!-- BOUTON AFFICHER LECTEUR -->
<button class="daw-toggle" id="dawToggle" onclick="showDaw()">&#9654; Lecteur</button>

<div class="page">

    <!-- EN-TÊTE -->
    <header>
        <h1>Emmenez-moi l&agrave;-bas</h1>
        <div class="sous-titre">Myriam Abel</div>
        <div class="credits">
            <strong>Auteur &amp; Compositeur</strong> &mdash; Micka&euml;l Guedj<br>
            Spectacle Savane &middot; 25 f&eacute;vrier 2026 &middot; Cagnes-sur-Mer
        </div>
    </header>

    <!-- MESSAGE -->
    <div class="msg">
        <b>Myriam,</b> voici les paroles et la musique pour apprendre le titre.<br><br>
        Tu chantes tout ce qui est <b>en noir</b>.
        Les passages <b style="color:var(--choeurs)">en orange italique</b> sont les ch&oelig;urs (d&eacute;j&agrave; enregistr&eacute;s, tu n'as rien &agrave; chanter dessus).
        Quand tu vois une <span style="border-left:3px solid var(--choeurs); padding-left:6px;">barre orange</span> &agrave; gauche, c'est toi qui chantes avec les ch&oelig;urs en m&ecirc;me temps.<br><br>
        Les petits traits bleus <span class="tempo-exemple">&#9472;&#9472;&#9472;&#9472;</span> indiquent la dur&eacute;e de tenue d'une note : plus le trait est long, plus tu restes sur la note.<br><br>
        <b>&#127911; Le lecteur de musique :</b> tu vois une <b>bande noire en bas de l'&eacute;cran</b>, c'est ton mini-studio ! Il reste toujours visible. Dedans tu as :<br>
        &bull; <b>&#9654; Play / &#9646;&#9646; Pause</b> &mdash; lancer ou arr&ecirc;ter la musique<br>
        &bull; <b>4 pistes</b> (Tout, Instru, Voix+Ch&oelig;urs, Voix solo) &mdash; appuie sur celle que tu veux, la musique continue sans coupure<br>
        &bull; <b>La barre color&eacute;e</b> &mdash; c'est la timeline ! Tu peux <b>glisser ton doigt</b> dessus pour naviguer dans la chanson. Le trait blanc te montre o&ugrave; tu en es.<br>
        &bull; <b>&#128266; Volume</b> &mdash; le curseur pour monter ou baisser le son<br><br>
        <b>&#127987; Les marqueurs (A, B, C, D, E) :</b> c'est comme dans un vrai logiciel de musique !<br>
        &bull; Appuie sur <b>&laquo;&nbsp;+ A&nbsp;&raquo;</b> pour poser un rep&egrave;re &agrave; l'endroit o&ugrave; tu es dans la chanson. Pareil pour B, C, D, E.<br>
        &bull; Chaque marqueur appara&icirc;t sur la barre avec <b>sa couleur</b> (rouge, vert, bleu, jaune, violet).<br>
        &bull; Tu peux <b>d&eacute;placer un marqueur avec le doigt</b> en le glissant sur la barre !<br>
        &bull; Quand un marqueur est pos&eacute;, appuie sur son bouton pour <b>revenir directement</b> &agrave; cet endroit.<br>
        &bull; La <b>zone verte</b> entre les deux premiers marqueurs montre la r&eacute;gion s&eacute;lectionn&eacute;e.<br>
        &bull; Appuie sur <b>&#128257;</b> pour <b>boucler</b> cette r&eacute;gion en non-stop (parfait pour r&eacute;p&eacute;ter un couplet ou un refrain).<br>
        &bull; Pour <b>supprimer un marqueur</b> : double-tape dessus sur la barre. Ou appuie sur &laquo;&nbsp;&#10005; Tout&nbsp;&raquo; pour tout effacer.<br><br>
        <button class="scroll-btn" onclick="scrollToDAW()">&#127911; Voir le lecteur</button><br><br>
        <b>Les boutons en haut &agrave; droite :</b><br>
        &bull; <b>Aa</b> &mdash; change la taille du texte (<b>8 niveaux</b>, du plus petit au plus grand, appuie plusieurs fois pour trouver la taille qui te convient)<br>
        &bull; <b>&#9789;</b> &mdash; mode sombre (fond noir, reposant pour les yeux)<br>
        &bull; <b>&#9974;</b> &mdash; plein &eacute;cran<br><br>
        <b>Ta touche personnelle :</b> la structure et les m&eacute;lodies que tu entends sur la d&eacute;mo sont la base du titre. Essaie de bien tenir les notes comme indiqu&eacute; par les traits bleus. Mais apr&egrave;s, tu es chez toi&nbsp;: si tu veux ajouter des vibes, des ad-libs, des variations ou toute autre touche qui te pla&icirc;t, tu es totalement libre. C'est ta voix qui donne vie &agrave; cette chanson, alors fais-toi plaisir&nbsp;!
        <button class="scroll-btn" onclick="document.getElementById('paroles').scrollIntoView({behavior:'smooth'})">&#9660; Aller aux paroles</button>
    </div>

    <!-- LEGENDE -->
    <div class="legende">
        <div class="leg"><div class="dot dot-m"></div> <span class="leg-label">Toi (soliste)</span></div>
        <div class="leg"><div class="dot dot-c"></div> <span class="leg-label" style="color:var(--choeurs); font-style:italic;">Ch&oelig;urs</span></div>
        <div class="leg"><div class="dot dot-e"></div> <span class="leg-label">Ensemble</span></div>
        <div class="leg"><div class="dot dot-i"></div> <span class="leg-label" style="color:var(--instru)">Musique</span></div>
        <div class="leg"><div class="dot dot-t"></div> <span class="leg-label" style="color:var(--tempo)">Tenue de note</span></div>
    </div>

    <!-- PAROLES -->
    <div class="paroles" id="paroles">

        <!-- INTRO -->
        <div class="section">
            <div class="section-head"><span class="section-label">Introduction</span></div>
            <div class="v i">&#9835; Ouverture orchestrale &mdash; Violon &amp; Ch&oelig;urs &#9835;</div>
        </div>

        <!-- COUPLET 1 -->
        <div class="section">
            <div class="section-head"><span class="section-label">Couplet 1</span></div>
            <div class="v m">Quand la nuit tombe sur l'Afrique</div>
            <div class="v m">Les &eacute;toiles s'allument une &agrave; une</div>
            <div class="v m">J'entends le chant des oiseaux</div>
            <div class="v m">Qui s'endorment, sous la lune</div>
            <div class="gap"></div>
            <div class="v c">Elle r&ecirc;ve, elle r&ecirc;ve</div>
            <div class="v m">Je ferme les yeux et je vois<span class="t t4"></span></div>
            <div class="v c">Elle r&ecirc;ve, elle r&ecirc;ve</div>
        </div>

        <!-- REFRAIN 1 -->
        <div class="section">
            <div class="section-head"><span class="section-label">Refrain</span></div>
            <div class="v c">Emmenez-moi l&agrave;-bas !</div>
            <div class="v n">&#9839; Violon</div>
            <div class="v c">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="gap"></div>
            <div class="v m"><span class="fort">Au pays du soleil d'or<span class="t t2"></span> !</span></div>
            <div class="v c">Soleil d'or !</div>
            <div class="gap"></div>
            <div class="v m">Emmenez-moi l&agrave;-bas !</div>
            <div class="v c">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="gap"></div>
            <div class="v m">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="v c">L&agrave;-bas !</div>
            <div class="gap"></div>
            <div class="v m"><span class="fort">O&ugrave; mon c&oelig;ur prend son envol<span class="t t12"></span> !</span></div>
            <div class="v c">Aaaah... Aaaah...</div>
        </div>

        <!-- INTERLUDE -->
        <div class="section">
            <div class="section-head"><span class="section-label">Interlude</span></div>
            <div class="v i">&#9835; Solo Violon &middot; Arp&egrave;ges de Harpe &#9835;</div>
            <div class="v c">Ohhh... Ohhh... (en nappes)</div>
        </div>

        <!-- COUPLET 2 -->
        <div class="section">
            <div class="section-head"><span class="section-label">Couplet 2</span></div>
            <div class="v m">Je vois les flamants roses danser</div>
            <div class="v c">Ohhh... Ohhh... Ohhh... Ohhh...</div>
            <div class="v m">Sur le lac aux reflets d'argent</div>
            <div class="v c">Ohhh... Ohhh... Ohhh... Ohhh...</div>
            <div class="v m">Les z&egrave;bres courent dans la poussi&egrave;re</div>
            <div class="v m">Et le soleil<span class="t t2"></span>, peint le firmament<span class="t t4"></span></div>
            <div class="gap"></div>
            <div class="v c">Elle r&ecirc;ve, elle r&ecirc;ve</div>
            <div class="v m">Et je tends les bras et je sens<span class="t t6"></span> !</div>
            <div class="v c">Elle sent, elle sent</div>
        </div>

        <!-- REFRAIN 2 -->
        <div class="section">
            <div class="section-head"><span class="section-label">Refrain 2</span></div>
            <div class="v e">Emmenez-moi l&agrave;-bas !</div>
            <div class="v c">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="v e">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="gap"></div>
            <div class="v e"><span class="fort">Au pays du soleil d'or<span class="t t2"></span> !</span></div>
            <div class="v c">Soleil d'or !</div>
            <div class="v e">Emmenez-moi l&agrave;-bas !</div>
            <div class="v c">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="gap"></div>
            <div class="v e">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="gap"></div>
            <div class="v e"><span class="fort">O&ugrave; mon c&oelig;ur prend son envol<span class="t t12"></span> !</span></div>
            <div class="v c">Prend son envol</div>
        </div>

        <!-- PONT -->
        <div class="section">
            <div class="section-head"><span class="section-label">Pont</span></div>
            <div class="v n">&#9839; Ta voix seule, accompagn&eacute;e du violon</div>
            <div class="gap"></div>
            <div class="v m">Mmm... Mmm... Mmm...<span class="t t4"></span></div>
            <div class="gap"></div>
            <div class="v m">Un jour j'irai...</div>
            <div class="v c">Mmm... Mmm... Mmm... Mmm...</div>
            <div class="v m">Un jour j'irai...</div>
            <div class="v c">Mmm... Mmm... Mmm... Mmm...</div>
            <div class="gap"></div>
            <div class="v m"><span class="fort">Un jour j'irai toucher<span class="t t4"></span> le ciel<span class="t t6"></span> d'Afrique<span class="t t6"></span> !</span></div>
            <div class="gap"></div>
            <div class="v c" style="font-size:1.1em; font-weight:600;">AAAAH !</div>
        </div>

        <!-- REFRAIN FINAL -->
        <div class="section">
            <div class="section-head"><span class="section-label">Refrain final</span></div>
            <div class="v m">Emmenez-moi l&agrave;-bas !</div>
            <div class="v c">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="v m">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="v c">L&agrave;-bas !</div>
            <div class="gap"></div>
            <div class="v m"><span class="fort">Au pays du soleil d'or<span class="t t2"></span> !</span></div>
            <div class="v c">Oui, du soleil d'or<span class="t t2"></span> !</div>
            <div class="gap"></div>
            <div class="v e">Emmenez-moi l&agrave;-bas !</div>
            <div class="v c">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="v m">L&agrave;-bas, l&agrave;-bas !</div>
            <div class="v c">L&agrave;-bas !</div>
            <div class="gap"></div>
            <div class="v e">O&ugrave; mon c&oelig;ur prend<span class="t t2"></span></div>
            <div class="v m"><span class="fort">son envol<span class="t t12"></span> !</span></div>
            <div class="v c">Prend son envol<span class="t t4"></span> !</div>
        </div>

        <!-- OUTRO -->
        <div class="section">
            <div class="section-head"><span class="section-label">Outro</span></div>
            <div class="v n">&#9839; Final avec chorus</div>
            <div class="gap"></div>
            <div class="v m">Ou&mdash; Ou Ou Ou&mdash;</div>
            <div class="v m">Ou Ou Ou&mdash;</div>
            <div class="v m">Ou Ou Ou<span class="t t4"></span></div>
            <div class="gap"></div>
            <div class="v m">Ou&mdash; Ou Ou Ou&mdash;</div>
            <div class="v m">Ou Ou Ou&mdash;</div>
            <div class="v m">Ou Ou Ou<span class="t t4"></span></div>
            <div class="gap"></div>
            <div class="v m"><span class="fort">Emmenez-moi l&agrave;-bas !</span></div>
            <div class="gap"></div>
            <div class="v c">L&agrave;-bas, l&agrave;-bas, l&agrave;-bas !</div>
            <div class="gap"></div>
            <div class="v m">Mmm Mmm Mmm<span class="t t8"></span></div>
        </div>

    </div>

    <!-- DROITS -->
    <div class="droits">
        <p>&laquo; Emmenez-moi l&agrave;-bas &raquo; &mdash; Auteur &amp; Compositeur : <strong>Micka&euml;l Guedj</strong></p>
        <p>Toute reproduction non autoris&eacute;e est interdite.</p>
        <p class="copy">&copy; 2026 Micka&euml;l Guedj &mdash; Tous droits r&eacute;serv&eacute;s</p>
    </div>

    <footer>Spectacle Savane &middot; 25 f&eacute;vrier 2026</footer>

</div>

<!-- LECTEUR DAW FLOTTANT -->
<div class="daw" id="daw">
    <div class="daw-progress-wrap" id="dawBar">
        <div class="daw-progress-bg"></div>
        <div class="daw-progress" id="dawProgress"></div>
        <div class="daw-playhead" id="dawPlayhead"></div>
        <div class="daw-region" id="dawRegion" style="display:none;"></div>
    </div>
    <div class="daw-top">
        <button class="daw-restart" onclick="dawRestart()" title="Retour au d&eacute;but">&#9198;</button>
        <button class="daw-play" id="dawPlay" onclick="dawTogglePlay()">&#9654;</button>
        <div class="daw-time" id="dawTime">0:00 / 0:00</div>
        <div class="daw-vol-wrap">
            <span class="daw-vol-icon" id="volIcon" onclick="dawToggleMute()" title="Volume">&#128266;</span>
            <input type="range" class="daw-vol-slider" id="volSlider" min="0" max="100" value="100" oninput="dawSetVolume(this.value)">
        </div>
    </div>
    <div class="daw-tracks">
        <div class="daw-track active" id="tr0" onclick="dawSelect(0)">
            <span class="daw-track-icon">&#127925;</span>
            <span class="daw-track-name">Tout</span>
        </div>
        <div class="daw-track" id="tr1" onclick="dawSelect(1)">
            <span class="daw-track-icon">&#127929;</span>
            <span class="daw-track-name">Instru</span>
        </div>
        <div class="daw-track" id="tr2" onclick="dawSelect(2)">
            <span class="daw-track-icon">&#127908;</span>
            <span class="daw-track-name">Voix+Ch&oelig;urs</span>
        </div>
        <div class="daw-track" id="tr3" onclick="dawSelect(3)">
            <span class="daw-track-icon">&#128483;</span>
            <span class="daw-track-name">Voix solo</span>
        </div>
    </div>
    <div class="daw-markers" id="dawMarkers">
        <button class="daw-mbtn" id="btnA" onclick="placeOrGoMarker('A')">+ A</button>
        <button class="daw-mbtn" id="btnB" onclick="placeOrGoMarker('B')">+ B</button>
        <button class="daw-mbtn" id="btnC" onclick="placeOrGoMarker('C')">+ C</button>
        <button class="daw-mbtn" id="btnD" onclick="placeOrGoMarker('D')">+ D</button>
        <button class="daw-mbtn" id="btnE" onclick="placeOrGoMarker('E')">+ E</button>
        <button class="daw-mbtn" id="btnLoop" onclick="toggleLoop()">&#128257;</button>
        <button class="daw-mbtn" onclick="clearAllMarkers()">&#10005; Tout</button>
        <span class="daw-minfo" id="markerInfo"></span>
    </div>
</div>

<script>
// ═══════════════════════════════════
// SPLASH / PLEIN ECRAN
// ═══════════════════════════════════
function enterPage() {
    document.getElementById('splash').classList.add('out');
    setTimeout(() => { document.getElementById('splash').style.display = 'none'; }, 600);
    // Tenter le plein ecran
    try {
        const el = document.documentElement;
        if (el.requestFullscreen) el.requestFullscreen();
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    } catch(e) {}
}

function toggleFS() {
    if (document.fullscreenElement || document.webkitFullscreenElement) {
        if (document.exitFullscreen) document.exitFullscreen();
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
    } else {
        const el = document.documentElement;
        if (el.requestFullscreen) el.requestFullscreen();
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    }
}

// ═══════════════════════════════════
// TAILLE / DARK
// ═══════════════════════════════════
let sz = parseInt(localStorage.getItem('myriam-sz') || '0');
const szClasses = ['', 'sz1', 'sz2', 'sz3', 'sz4', 'sz5', 'sz6', 'sz7'];
(function initSize() {
    if (sz > 0 && sz < szClasses.length) document.body.classList.add(szClasses[sz]);
})();

function resize() {
    szClasses.forEach(c => { if (c) document.body.classList.remove(c); });
    sz = (sz + 1) % szClasses.length;
    if (sz > 0) document.body.classList.add(szClasses[sz]);
    localStorage.setItem('myriam-sz', sz);
}

// Restaurer le mode sombre si sauvegarde
if (localStorage.getItem('myriam-dark') === '1') {
    document.body.classList.add('dark');
    document.addEventListener('DOMContentLoaded', () => {
        const b = document.getElementById('dk');
        b.innerHTML = '\u2606';
        b.classList.add('on');
    });
}

function dark() {
    document.body.classList.toggle('dark');
    const b = document.getElementById('dk');
    const isDark = document.body.classList.contains('dark');
    b.innerHTML = isDark ? '&#9788;' : '&#9789;';
    b.classList.toggle('on');
    localStorage.setItem('myriam-dark', isDark ? '1' : '0');
}

// ═══════════════════════════════════
// LECTEUR DAW — 4 PISTES SYNCHRONISEES
// ═══════════════════════════════════
const files = [
    '../musiques/tout.mp3',
    '../musiques/instrumental.mp3',
    '../musiques/voix-et-choeurs.mp3',
    '../musiques/voix-solo.mp3'
];

const audios = [];
let activeTrack = 0;
let isPlaying = false;
let dawReady = false;
let masterVol = parseFloat(localStorage.getItem('myriam-vol') || '1');

// Creer les 4 elements audio
files.forEach((src, i) => {
    const a = new Audio();
    a.preload = 'auto';
    a.src = src;
    a.volume = (i === 0) ? masterVol : 0;
    audios.push(a);
});

// Synchronisation : on utilise la piste 0 comme reference
audios[0].addEventListener('timeupdate', updateDAW);
audios[0].addEventListener('loadedmetadata', () => { dawReady = true; updateDAW(); });
audios[0].addEventListener('ended', () => {
    isPlaying = false;
    document.getElementById('dawPlay').innerHTML = '&#9654;';
    document.getElementById('dawPlay').classList.remove('playing');
    // Auto-retour au debut
    audios.forEach(a => { a.currentTime = 0; });
    updateDAW();
});

function dawTogglePlay() {
    if (!dawReady) return;
    if (isPlaying) {
        audios.forEach(a => a.pause());
        isPlaying = false;
        document.getElementById('dawPlay').innerHTML = '&#9654;';
        document.getElementById('dawPlay').classList.remove('playing');
    } else {
        // Synchroniser toutes les pistes au meme temps
        const t = audios[0].currentTime;
        audios.forEach(a => { a.currentTime = t; a.play().catch(()=>{}); });
        isPlaying = true;
        document.getElementById('dawPlay').innerHTML = '&#9646;&#9646;';
        document.getElementById('dawPlay').classList.add('playing');
    }
}

function dawSelect(idx) {
    activeTrack = idx;
    audios.forEach((a, i) => {
        const tr = document.getElementById('tr' + i);
        if (i === idx) {
            a.volume = masterVol;
            tr.classList.add('active');
        } else {
            a.volume = 0;
            tr.classList.remove('active');
        }
    });
}

function dawRestart() {
    audios.forEach(a => { a.currentTime = 0; });
    updateDAW();
}

// ═══════════════════════════════════
// VOLUME GLOBAL
// ═══════════════════════════════════
document.getElementById('volSlider').value = Math.round(masterVol * 100);
updateVolIcon();

function dawSetVolume(val) {
    masterVol = val / 100;
    localStorage.setItem('myriam-vol', masterVol);
    audios[activeTrack].volume = masterVol;
    updateVolIcon();
}

function dawToggleMute() {
    const slider = document.getElementById('volSlider');
    if (masterVol > 0) {
        masterVol = 0;
        slider.value = 0;
    } else {
        masterVol = 1;
        slider.value = 100;
    }
    localStorage.setItem('myriam-vol', masterVol);
    audios[activeTrack].volume = masterVol;
    updateVolIcon();
}

function updateVolIcon() {
    const icon = document.getElementById('volIcon');
    if (masterVol === 0) icon.innerHTML = '\uD83D\uDD07';
    else if (masterVol < 0.5) icon.innerHTML = '\uD83D\uDD09';
    else icon.innerHTML = '\uD83D\uDD0A';
}

// ═══════════════════════════════════
// TIMELINE TACTILE (seek au doigt)
// ═══════════════════════════════════
const dawBar = document.getElementById('dawBar');

function seekFromEvent(e) {
    if (!dawReady) return;
    const rect = dawBar.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const pct = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
    const t = pct * audios[0].duration;
    audios.forEach(a => { a.currentTime = t; });
    updateDAW();
}

let seekDragging = false;

dawBar.addEventListener('mousedown', (e) => {
    if (e.target.classList.contains('daw-marker')) return;
    seekDragging = true;
    seekFromEvent(e);
});
dawBar.addEventListener('touchstart', (e) => {
    if (e.target.classList.contains('daw-marker')) return;
    seekDragging = true;
    seekFromEvent(e);
}, { passive: true });

document.addEventListener('mousemove', (e) => { if (seekDragging) seekFromEvent(e); });
document.addEventListener('touchmove', (e) => { if (seekDragging) seekFromEvent(e); }, { passive: true });
document.addEventListener('mouseup', () => { seekDragging = false; });
document.addEventListener('touchend', () => { seekDragging = false; });

// ═══════════════════════════════════
// MISE A JOUR AFFICHAGE
// ═══════════════════════════════════
function updateDAW() {
    const a = audios[0];
    if (!a.duration) return;
    const pct = (a.currentTime / a.duration) * 100;
    document.getElementById('dawProgress').style.width = pct + '%';
    document.getElementById('dawPlayhead').style.left = pct + '%';
    document.getElementById('dawTime').textContent = fmt(a.currentTime) + ' / ' + fmt(a.duration);
}

function fmt(s) {
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return m + ':' + (sec < 10 ? '0' : '') + sec;
}

// Masquer / afficher le DAW
function hideDaw() {
    document.getElementById('daw').classList.add('hidden');
    document.getElementById('dawToggle').classList.add('show');
}

function showDaw() {
    document.getElementById('daw').classList.remove('hidden');
    document.getElementById('dawToggle').classList.remove('show');
}

// ═══════════════════════════════════
// SCROLL VERS LE LECTEUR
// ═══════════════════════════════════
function scrollToDAW() {
    const daw = document.getElementById('daw');
    daw.scrollIntoView({ behavior: 'smooth', block: 'end' });
    daw.classList.add('highlight');
    setTimeout(() => daw.classList.remove('highlight'), 2800);
}

// ═══════════════════════════════════
// MARQUEURS VISUELS A-E + REGIONS + BOUCLE
// ═══════════════════════════════════
const allLabels = ['A','B','C','D','E'];
let markers = {};
let markerEls = {};
let looping = false;
let loopPair = [null, null]; // les 2 marqueurs utilises pour la boucle

function placeOrGoMarker(label) {
    if (!dawReady) return;
    if (markers[label] !== undefined) {
        // Le marqueur existe : on y va
        audios.forEach(a => { a.currentTime = markers[label]; });
        updateDAW();
        return;
    }
    // Placer un nouveau marqueur
    markers[label] = audios[0].currentTime;
    createMarkerEl(label);
    const btn = document.getElementById('btn' + label);
    btn.classList.add('set-' + label);
    btn.textContent = label;
    autoDetectRegion();
    updateMarkerInfo();
}

function removeMarker(label) {
    if (markers[label] === undefined) return;
    if (markerEls[label]) markerEls[label].remove();
    delete markers[label];
    delete markerEls[label];
    const btn = document.getElementById('btn' + label);
    btn.className = 'daw-mbtn';
    btn.textContent = '+ ' + label;
    // Si on supprime un marqueur de la boucle, desactiver la boucle
    if (loopPair[0] === label || loopPair[1] === label) {
        looping = false;
        document.getElementById('btnLoop').classList.remove('loop');
    }
    autoDetectRegion();
    updateMarkerInfo();
}

function createMarkerEl(label) {
    if (markerEls[label]) markerEls[label].remove();
    const el = document.createElement('div');
    el.className = 'daw-marker';
    el.setAttribute('data-label', label);
    el.style.left = ((markers[label] / audios[0].duration) * 100) + '%';
    dawBar.appendChild(el);
    markerEls[label] = el;

    // Double-clic / double-tap pour supprimer
    el.addEventListener('dblclick', (e) => {
        e.stopPropagation();
        removeMarker(label);
    });

    // Drag au doigt / souris
    let dragging = false;
    const onMove = (e) => {
        if (!dragging) return;
        const rect = dawBar.getBoundingClientRect();
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const pct = Math.max(0, Math.min(1, (cx - rect.left) / rect.width));
        markers[label] = pct * audios[0].duration;
        el.style.left = (pct * 100) + '%';
        autoDetectRegion();
        updateMarkerInfo();
    };
    const onEnd = () => {
        dragging = false;
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('touchmove', onMove);
        document.removeEventListener('mouseup', onEnd);
        document.removeEventListener('touchend', onEnd);
    };
    el.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        dragging = true;
        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', onEnd);
    });
    el.addEventListener('touchstart', (e) => {
        e.stopPropagation();
        dragging = true;
        document.addEventListener('touchmove', onMove, { passive: true });
        document.addEventListener('touchend', onEnd);
    }, { passive: true });
}

function autoDetectRegion() {
    // Trouver les 2 premiers marqueurs poses (par ordre A-E)
    const region = document.getElementById('dawRegion');
    const placed = allLabels.filter(l => markers[l] !== undefined);
    if (placed.length >= 2) {
        loopPair = [placed[0], placed[1]];
        const dur = audios[0].duration;
        const t1 = markers[placed[0]];
        const t2 = markers[placed[1]];
        const startPct = (Math.min(t1, t2) / dur) * 100;
        const endPct = (Math.max(t1, t2) / dur) * 100;
        region.style.left = startPct + '%';
        region.style.width = (endPct - startPct) + '%';
        region.style.display = 'block';
    } else {
        loopPair = [null, null];
        region.style.display = 'none';
        if (looping) {
            looping = false;
            document.getElementById('btnLoop').classList.remove('loop');
        }
    }
}

function toggleLoop() {
    if (loopPair[0] === null || loopPair[1] === null) return;
    looping = !looping;
    document.getElementById('btnLoop').classList.toggle('loop', looping);
}

function clearAllMarkers() {
    allLabels.forEach(l => {
        if (markerEls[l]) markerEls[l].remove();
        const btn = document.getElementById('btn' + l);
        btn.className = 'daw-mbtn';
        btn.textContent = '+ ' + l;
    });
    markers = {};
    markerEls = {};
    looping = false;
    loopPair = [null, null];
    document.getElementById('btnLoop').classList.remove('loop');
    document.getElementById('dawRegion').style.display = 'none';
    document.getElementById('markerInfo').textContent = '';
}

function updateMarkerInfo() {
    const placed = allLabels.filter(l => markers[l] !== undefined);
    const txt = placed.map(l => l + ' ' + fmt(markers[l])).join('  ');
    document.getElementById('markerInfo').textContent = txt;
}

// Boucle pendant la lecture
audios[0].addEventListener('timeupdate', () => {
    if (looping && loopPair[0] && loopPair[1]) {
        const t1 = markers[loopPair[0]];
        const t2 = markers[loopPair[1]];
        if (t1 === undefined || t2 === undefined) return;
        const start = Math.min(t1, t2);
        const end = Math.max(t1, t2);
        if (audios[0].currentTime >= end || audios[0].currentTime < start) {
            audios.forEach(a => { a.currentTime = start; });
        }
    }
});

</script>

</body>
</html>
